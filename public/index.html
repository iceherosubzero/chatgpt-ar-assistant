<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>AR Car Showroom</title>
<!--script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script-->
<!--script src="https://cdn.jsdelivr.net/npm/aframe-ar@1.8.0/dist/aframe-ar.min.js"></script-->
  <!--script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script-->
  <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
  <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script>
<style>
body, html { margin: 0; overflow: hidden; }
#ui { position: fixed; bottom: 10px; width: 100%; display: flex; justify-content: center; gap: 8px; }
#prompt { width: 70%; padding: 8px; border-radius: 10px; border: 1px solid #ccc; font-size: 16px; }
#send, #talk { padding: 8px 16px; border-radius: 10px; border: none; background-color: #0084ff; color: white; font-size: 16px; cursor: pointer; }
#talk.listening { background-color: #ff5555; }
</style>
</head>
<body>

<a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" vr-mode-ui="enabled: false" renderer="antialias: true;">
  
  <!-- 3D Car -->
  <a-entity gltf-model="url(car_model.glb)" position="0 0 -2" scale="0.5 0.5 0.5"></a-entity>

  <!-- AI Orb -->
  <a-entity id="assistant" position="1 0 -2">
    <a-sphere id="orb" color="#00ccff" radius="0.25" material="emissive: #00ccff; emissiveIntensity: 0.5;"></a-sphere>
    <a-text id="reply" value="Ask me about this car!" position="-1 0.5 0" width="3" color="#fff"></a-text>
  </a-entity>

  <!-- Animated Glowing Hotspots -->
  <a-entity id="wheel-hotspot" position="0.5 0 -2" geometry="primitive: sphere; radius: 0.12"
            material="color:#ff9900; opacity:0.6; emissive:#ff9900; emissiveIntensity:0.8"
            class="clickable" data-question="Tell me about the wheels of this car."
            animation="property: scale; dir: alternate; dur: 1000; loop: true; to: 1.3 1.3 1.3"></a-entity>

  <a-entity id="engine-hotspot" position="0 0.5 -2" geometry="primitive: sphere; radius: 0.12"
            material="color:#33ccff; opacity:0.6; emissive:#33ccff; emissiveIntensity:0.8"
            class="clickable" data-question="Can you explain the engine specifications?"
            animation="property: scale; dir: alternate; dur: 1000; loop: true; to: 1.3 1.3 1.3"></a-entity>

  <a-entity id="interior-hotspot" position="-0.5 0 -2" geometry="primitive: sphere; radius: 0.12"
            material="color:#ff33cc; opacity:0.6; emissive:#ff33cc; emissiveIntensity:0.8"
            class="clickable" data-question="What are the interior features of this car?"
            animation="property: scale; dir: alternate; dur: 1000; loop: true; to: 1.3 1.3 1.3"></a-entity>

  <a-camera position="0 0 0"></a-camera>
</a-scene>

<div id="ui">
  <input type="text" id="prompt" placeholder="Ask about the car..." />
  <button id="talk">🎤</button>
  <button id="send">Send</button>
</div>

<script>
const orb = document.getElementById("orb");
const replyText = document.getElementById("reply");
const talkBtn = document.getElementById("talk");
const sendBtn = document.getElementById("send");
const promptInput = document.getElementById("prompt");

// TTS
function speak(text){
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = "en-US";
  speechSynthesis.speak(utter);
}

// Map emotion to orb color
function updateOrbEmotionStructured(emotion){
  let color="#00ccff";
  switch(emotion){
    case "happy": color="#00ff99"; break;
    case "excited": color="#ffcc00"; break;
    case "sad": color="#3366ff"; break;
    case "angry": color="#ff3333"; break;
    case "calm": color="#00cccc"; break;
    case "curious": color="#ff66ff"; break;
  }
  orb.setAttribute("color", color);
  orb.setAttribute("material", `emissive:${color}; emissiveIntensity:0.8;`);
}

// Handle AI question
async function handleQuestion(question){
  if(!question) return;
  replyText.setAttribute("value","🤔 Thinking...");
  try{
    const res = await fetch("/api/chat",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({prompt: question})
    });
    const data = await res.json();
    const answer = data.answer || "🤖 Sorry, I don't know.";
    const emotion = data.emotion || "curious";
    replyText.setAttribute("value", answer);
    speak(answer);
    updateOrbEmotionStructured(emotion);
  }catch(err){
    console.error(err);
    replyText.setAttribute("value","🤖 Something went wrong!");
    updateOrbEmotionStructured("sad");
  }
}

// Send button
sendBtn.onclick = () => {
  const q=promptInput.value.trim();
  promptInput.value="";
  handleQuestion(q);
};

// Voice input
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
if(SpeechRecognition){
  const recognition = new SpeechRecognition();
  recognition.lang="en-US";
  recognition.onstart = ()=>{ talkBtn.classList.add("listening"); talkBtn.textContent="🎙️ Listening..."; };
  recognition.onend = ()=>{ talkBtn.classList.remove("listening"); talkBtn.textContent="🎤"; };
  recognition.onresult = (e)=>{ const q=e.results[0][0].transcript; promptInput.value=q; handleQuestion(q); };
  talkBtn.onclick = ()=>recognition.start();
}else { talkBtn.disabled=true; talkBtn.textContent="❌ No mic support"; }

// Hotspot clicks
document.querySelectorAll(".clickable").forEach(el=>{
  el.addEventListener("click",()=> handleQuestion(el.dataset.question));
});

// Optional hover glow for desktop
document.querySelectorAll(".clickable").forEach(el=>{
  el.addEventListener("mouseenter",()=> el.setAttribute("material","emissiveIntensity:1.5"));
  el.addEventListener("mouseleave",()=> el.setAttribute("material","emissiveIntensity:0.8"));
});
</script>

</body>
</html>







